<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        html {
            background: black;
            height: 100%;
            overflow: hidden;
        }

        body {
            margin: 0;
            height: 100%;
        }
    </style>
</head>

<body>
    <script>
let streams;

function setup() {
  createCanvas(innerWidth, innerHeight);
  textFont('monospace', 16);
  colorMode(HSL);
  streams = Streams();
}

function draw() {
  // opacity set on background to add a bit of a blur effect
  background(0, 0, 0, 0.6);
  streams.draw();
}

function Streams() {
  // set up the streams
  const streams = [];
  for (let i = 0; i < innerWidth / textSize(); i++) {if (window.CP.shouldStopExecution(0)) break;
    const x = i * textSize();
    const y = round(random(-1000, 0));
    const speed = round(random(3, 7));
    const length = round(random(1, innerHeight / textSize()));
    const stream = Stream(x, y, speed, length);
    streams.push(stream);
  }

  // return object with access to draw function
  window.CP.exitedLoop(0);return {
    draw: function () {
      for (let i = 0, length = streams.length; i < length; i++) {if (window.CP.shouldStopExecution(1)) break;
        streams[i].draw();
      }window.CP.exitedLoop(1);
    } };

}

function Stream(x, y, speed, length) {
  // setup symbols in stream
  const symbols = [];
  for (let i = 0; i < length; i++) {if (window.CP.shouldStopExecution(2)) break;
    const changeRate = round(random(20, 40));
    let lightness;
    if (i === 0) {
      lightness = (1 - i / length) * 100;
    } else if (i === 1) {
      lightness = (1 - i / length) * 95;
    } else if (i === 2) {
      lightness = (1 - i / length) * 90;
    } else {
      lightness = (1 - i / length) * 50;
    }
    const colour = [120, 100, lightness];
    const symbol = Symbol(x, y, speed, changeRate, colour);
    symbols.push(symbol);
    y -= textSize();
  }

  // return object with access to draw function
  window.CP.exitedLoop(2);return {
    draw: function () {
      for (let i = 0, length = symbols.length; i < length; i++) {if (window.CP.shouldStopExecution(3)) break;
        symbols[i].draw();
      }window.CP.exitedLoop(3);
    } };

}

function Symbol(x, y, speed, changeRate, colour) {
  let character;

  // return object with access to draw function
  return {
    draw: function () {
      if (frameCount % changeRate === 0 || !character) {
        character = char(round(random(65381, 65440)));
      }
      y = y > height + textSize() ? 0 : y + speed;
      fill(colour);
      text(character, x, y);
    } };

}

function windowResized() {
  resizeCanvas(innerWidth, innerHeight);
  streams = Streams();
}
    </script>
</body>

</html>